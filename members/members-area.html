import React, { useState, useEffect } from 'react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import { Settings, Users, Clock, BarChart2, Globe, Activity, Heart, Coffee, LogOut } from 'lucide-react';

// Sample analytics data (would come from backend in production)
const visitorData = [
  { name: 'Jan', visitors: 4000, pageViews: 6400 },
  { name: 'Feb', visitors: 3000, pageViews: 4300 },
  { name: 'Mar', visitors: 2000, pageViews: 3800 },
  { name: 'Apr', visitors: 2780, pageViews: 4908 },
  { name: 'May', visitors: 1890, pageViews: 2800 },
  { name: 'Jun', visitors: 2390, pageViews: 3800 },
];

const pageAnalytics = [
  { page: 'Home', views: 45600, avgTime: '2:30' },
  { page: 'Products', views: 32400, avgTime: '3:45' },
  { page: 'About', views: 18900, avgTime: '1:15' },
  { page: 'Contact', views: 12300, avgTime: '0:45' },
];

export default function Dashboard() {
  const [activeTab, setActiveTab] = useState('analytics');
  const [username, setUsername] = useState('');
  const [lastLogin, setLastLogin] = useState('');

  useEffect(() => {
    // Get user data from session storage (set during login)
    const userData = JSON.parse(sessionStorage.getItem('userData'));
    if (userData) {
      setUsername(userData.username);
      setLastLogin(new Date().toLocaleString());
    } else {
      // Redirect to login if no session exists
      window.location.href = '/login';
    }
  }, []);

  const handleLogout = () => {
    sessionStorage.removeItem('userData');
    window.location.href = '/login';
  };

  const StatCard = ({ title, value, icon: Icon, color }) => (
    <div className="bg-white rounded-lg p-6 shadow-md">
      <div className="flex items-center justify-between">
        <div>
          <p className="text-gray-500 text-sm">{title}</p>
          <p className="text-2xl font-semibold mt-2">{value}</p>
        </div>
        <div className={`p-3 rounded-full ${color}`}>
          <Icon className="w-6 h-6 text-white" />
        </div>
      </div>
    </div>
  );

  const UserGreeting = () => (
    <div className="bg-white rounded-lg p-6 shadow-md mb-8">
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-2xl font-bold text-gray-800">Hello, {username}!</h1>
          <p className="text-gray-500 mt-1">Last login: {lastLogin}</p>
        </div>
        <button 
          onClick={handleLogout}
          className="flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"
        >
          <LogOut className="w-4 h-4 mr-2" />
          Logout
        </button>
      </div>
    </div>
  );

  const Sidebar = () => (
    <div className="w-64 bg-gray-900 h-screen fixed left-0 top-0 text-white p-6">
      <div className="mb-8">
        <h2 className="text-xl font-bold">Surya Dashboard</h2>
        <p className="text-sm text-gray-400 mt-2">{username}'s Workspace</p>
      </div>
      
      <nav className="space-y-2">
        <button 
          onClick={() => setActiveTab('analytics')}
          className={`w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${
            activeTab === 'analytics' ? 'bg-yellow-500 text-white' : 'hover:bg-gray-800'
          }`}>
          <BarChart2 className="w-5 h-5" />
          <span>Analytics</span>
        </button>
        
        <button 
          onClick={() => setActiveTab('settings')}
          className={`w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${
            activeTab === 'settings' ? 'bg-yellow-500 text-white' : 'hover:bg-gray-800'
          }`}>
          <Settings className="w-5 h-5" />
          <span>Settings</span>
        </button>
      </nav>
    </div>
  );

  return (
    <div className="min-h-screen bg-gray-100">
      <Sidebar />
      
      <main className="ml-64 p-8">
        <UserGreeting />

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <StatCard 
            title="Total Visitors" 
            value="124,892" 
            icon={Users} 
            color="bg-blue-500"
          />
          <StatCard 
            title="Active Users" 
            value="1,234" 
            icon={Activity} 
            color="bg-green-500"
          />
          <StatCard 
            title="Avg. Session" 
            value="2m 45s" 
            icon={Clock} 
            color="bg-purple-500"
          />
          <StatCard 
            title="Bounce Rate" 
            value="32.4%" 
            icon={Heart} 
            color="bg-red-500"
          />
        </div>

        <div className="bg-white rounded-lg p-6 shadow-md mb-8">
          <h3 className="text-lg font-semibold mb-4">Visitor Trends</h3>
          <div className="h-64">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={visitorData}>
                <defs>
                  <linearGradient id="colorVisitors" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#fbbf24" stopOpacity={0.8}/>
                    <stop offset="95%" stopColor="#fbbf24" stopOpacity={0}/>
                  </linearGradient>
                </defs>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="name" />
                <YAxis />
                <Tooltip />
                <Area 
                  type="monotone" 
                  dataKey="visitors" 
                  stroke="#fbbf24" 
                  fillOpacity={1} 
                  fill="url(#colorVisitors)" 
                />
              </AreaChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-md">
          <div className="p-6">
            <h3 className="text-lg font-semibold mb-4">Page Analytics</h3>
            <div className="overflow-x-auto">
              <table className="min-w-full">
                <thead>
                  <tr className="bg-gray-50">
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Page
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Views
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Avg. Time
                    </th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {pageAnalytics.map((page, index) => (
                    <tr key={index}>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        {page.page}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {page.views.toLocaleString()}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {page.avgTime}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}
