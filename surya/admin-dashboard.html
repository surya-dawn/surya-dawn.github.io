<!DOCTYPE html>
<!-- Previous head and style sections remain the same until the main content -->

<!-- Add this section inside the main content area, after the Stats Grid and before the Charts Grid -->
            <!-- Login Activity Panel -->
            <div class="glass-card rounded-xl p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Recent Login Activity</h3>
                    <div class="flex items-center space-x-2">
                        <span id="activeUsersCount" class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                            2 Active Users
                        </span>
                        <button onclick="clearLoginHistory()" class="text-sm text-gray-500 hover:text-gray-700">
                            Clear History
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="text-left text-sm text-gray-500">
                                <th class="pb-3 px-4">Username</th>
                                <th class="pb-3 px-4">Role</th>
                                <th class="pb-3 px-4">Login Time</th>
                                <th class="pb-3 px-4">Status</th>
                                <th class="pb-3 px-4">Location</th>
                            </tr>
                        </thead>
                        <tbody id="loginActivityTable" class="text-sm">
                            <!-- Login activity will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

<!-- Add this JavaScript before the closing body tag -->
<script>
    // Login tracking functionality
    class LoginTracker {
        constructor() {
            this.loginHistory = JSON.parse(localStorage.getItem('loginHistory')) || [];
            this.activeUsers = new Set();
            this.initializeTracker();
        }

        initializeTracker() {
            this.updateActiveUsersCount();
            this.displayLoginHistory();
            this.startActivityMonitoring();
        }

        async recordLogin(username, role) {
            const timestamp = new Date().toISOString();
            const location = await this.getLocation();
            
            const loginRecord = {
                username,
                role,
                timestamp,
                status: 'Active',
                location: location,
                sessionId: Math.random().toString(36).substr(2, 9)
            };

            this.loginHistory.unshift(loginRecord);
            this.activeUsers.add(loginRecord.sessionId);
            
            // Keep only last 50 records
            if (this.loginHistory.length > 50) {
                this.loginHistory.pop();
            }

            this.saveHistory();
            this.updateDisplay();
        }

        async getLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return `${data.city}, ${data.country_code}`;
            } catch (error) {
                return 'Unknown Location';
            }
        }

        updateActiveUsersCount() {
            const activeCount = this.activeUsers.size;
            const countElement = document.getElementById('activeUsersCount');
            if (countElement) {
                countElement.textContent = `${activeCount} Active User${activeCount !== 1 ? 's' : ''}`;
            }
        }

        displayLoginHistory() {
            const tableBody = document.getElementById('loginActivityTable');
            if (!tableBody) return;

            tableBody.innerHTML = this.loginHistory.map(record => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-${this.getRandomColor()}-100 rounded-full flex items-center justify-center mr-3">
                                <span class="text-${this.getRandomColor()}-600 font-semibold">
                                    ${record.username.charAt(0).toUpperCase()}
                                </span>
                            </div>
                            ${record.username}
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 bg-${record.role === 'admin' ? 'purple' : 'blue'}-100 
                                   text-${record.role === 'admin' ? 'purple' : 'blue'}-800 rounded-full text-xs">
                            ${record.role}
                        </span>
                    </td>
                    <td class="py-3 px-4">${this.formatTimestamp(record.timestamp)}</td>
                    <td class="py-3 px-4">
                        <span class="flex items-center">
                            <span class="w-2 h-2 rounded-full ${this.isActive(record.sessionId) ? 'bg-green-400' : 'bg-gray-400'} mr-2"></span>
                            ${this.isActive(record.sessionId) ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td class="py-3 px-4">${record.location}</td>
                </tr>
            `).join('');
        }

        getRandomColor() {
            const colors = ['blue', 'green', 'purple', 'yellow', 'red', 'indigo'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMinutes = Math.floor((now - date) / 60000);

            if (diffMinutes < 1) return 'Just now';
            if (diffMinutes < 60) return `${diffMinutes}m ago`;
            if (diffMinutes < 1440) return `${Math.floor(diffMinutes / 60)}h ago`;
            return date.toLocaleDateString();
        }

        isActive(sessionId) {
            return this.activeUsers.has(sessionId);
        }

        startActivityMonitoring() {
            // Check for inactive sessions every minute
            setInterval(() => {
                const thirtyMinutesAgo = new Date(Date.now() - 30 * 60 * 1000);
                
                this.loginHistory.forEach(record => {
                    if (new Date(record.timestamp) < thirtyMinutesAgo && this.activeUsers.has(record.sessionId)) {
                        this.activeUsers.delete(record.sessionId);
                    }
                });

                this.updateDisplay();
            }, 60000);
        }

        updateDisplay() {
            this.updateActiveUsersCount();
            this.displayLoginHistory();
            this.saveHistory();
        }

        saveHistory() {
            localStorage.setItem('loginHistory', JSON.stringify(this.loginHistory));
        }

        clearHistory() {
            this.loginHistory = [];
            this.activeUsers.clear();
            this.updateDisplay();
        }
    }

    // Initialize login tracker
    const loginTracker = new LoginTracker();

    // Modify the existing authentication check to record logins
    function checkAuth() {
        const currentUser = sessionStorage.getItem('currentUser');
        if (!currentUser || currentUser !== 'Ghost') {
            window.location.href = 'login.html';
        } else {
            // Record the login
            loginTracker.recordLogin(currentUser, 'admin');
        }
    }

    // Add clear history function
    function clearLoginHistory() {
        if (confirm('Are you sure you want to clear the login history?')) {
            loginTracker.clearHistory();
        }
    }

    // Existing initialization code remains the same
</script>
</body>
</html>
